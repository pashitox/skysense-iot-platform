{"ast":null,"code":"import { Subject, BehaviorSubject } from 'rxjs';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nexport let WebsocketService = /*#__PURE__*/(() => {\n  class WebsocketService {\n    constructor() {\n      this.sensorsSubject = new Subject();\n      this.sensors$ = this.sensorsSubject.asObservable();\n      this.connectionStatus = new BehaviorSubject('disconnected');\n      this.connectionStatus$ = this.connectionStatus.asObservable();\n      this.ws = null;\n      this.simulationMode = false;\n      this.simulationInterval = null;\n      this.reconnectTimeout = null;\n      console.log('ðŸ”§ WebSocket Configuration:');\n      console.log('   - Environment:', environment.production ? 'production' : 'development');\n      console.log('   - WebSocket URL:', environment.wsUrl);\n      this.connectToBackend();\n    }\n    connectToBackend() {\n      try {\n        console.log('ðŸ”„ Connecting to backend...');\n        console.log('   - Target URL:', environment.wsUrl);\n        this.connectionStatus.next('connecting');\n        // Usar EXCLUSIVAMENTE la URL del environment\n        this.ws = new WebSocket(environment.wsUrl);\n        this.ws.onopen = () => {\n          console.log('âœ… CONNECTED to backend WebSocket');\n          this.connectionStatus.next('connected');\n          this.simulationMode = false;\n          if (this.simulationInterval) {\n            clearInterval(this.simulationInterval);\n            this.simulationInterval = null;\n          }\n        };\n        this.ws.onmessage = event => {\n          try {\n            const data = JSON.parse(event.data);\n            console.log('ðŸ“Š Received real sensor data:', data.sensor_id);\n            this.sensorsSubject.next(data);\n          } catch (error) {\n            console.error('âŒ Error parsing WebSocket message:', error);\n          }\n        };\n        this.ws.onerror = error => {\n          console.error('âŒ WebSocket error:', error);\n          this.connectionStatus.next('error');\n          this.startSimulation();\n        };\n        this.ws.onclose = event => {\n          console.log('ðŸ”Œ WebSocket closed');\n          this.connectionStatus.next('disconnected');\n          // Intentar reconectar despuÃ©s de 5 segundos\n          if (!this.simulationMode) {\n            console.log('ðŸ”„ Will attempt reconnect in 5 seconds...');\n            this.reconnectTimeout = setTimeout(() => {\n              this.connectToBackend();\n            }, 5000);\n          }\n        };\n      } catch (error) {\n        console.error('âŒ Failed to create WebSocket:', error);\n        this.connectionStatus.next('error');\n        this.startSimulation();\n      }\n    }\n    startSimulation() {\n      if (this.simulationMode) return;\n      console.log('ðŸŽ­ Backend not available - Starting simulation');\n      this.simulationMode = true;\n      this.connectionStatus.next('simulation');\n      this.simulationInterval = setInterval(() => {\n        const simulatedData = {\n          sensor_id: 'simulated_' + Math.floor(Math.random() * 5),\n          temperature: 20 + Math.random() * 15,\n          humidity: 40 + Math.random() * 40,\n          pressure: 990 + Math.random() * 40,\n          timestamp: new Date().toISOString()\n        };\n        console.log('ðŸŽ­ SIMULATED data:', simulatedData);\n        this.sensorsSubject.next(simulatedData);\n      }, 2000);\n    }\n    // MÃ©todos pÃºblicos que el dashboard espera\n    isSimulationMode() {\n      return this.simulationMode;\n    }\n    disconnect() {\n      if (this.reconnectTimeout) {\n        clearTimeout(this.reconnectTimeout);\n      }\n      if (this.simulationInterval) {\n        clearInterval(this.simulationInterval);\n        this.simulationMode = false;\n      }\n      if (this.ws) {\n        this.ws.close();\n        this.ws = null;\n      }\n    }\n    connect() {\n      this.disconnect();\n      this.connectToBackend();\n    }\n    toggleSimulationMode() {\n      if (this.simulationMode) {\n        this.disconnect();\n        this.connectToBackend();\n      } else {\n        this.disconnect();\n        this.startSimulation();\n      }\n    }\n    reconnect() {\n      this.connect();\n    }\n    close() {\n      this.disconnect();\n    }\n    static {\n      this.Éµfac = function WebsocketService_Factory(t) {\n        return new (t || WebsocketService)();\n      };\n    }\n    static {\n      this.Éµprov = /*@__PURE__*/i0.ÉµÉµdefineInjectable({\n        token: WebsocketService,\n        factory: WebsocketService.Éµfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return WebsocketService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}