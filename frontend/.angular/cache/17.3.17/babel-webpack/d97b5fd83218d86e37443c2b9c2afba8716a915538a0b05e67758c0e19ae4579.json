{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nexport let WebsocketService = /*#__PURE__*/(() => {\n  class WebsocketService {\n    constructor() {\n      this.sensorsSubject = new BehaviorSubject(null);\n      this.sensors$ = this.sensorsSubject.asObservable();\n      this.connectionStatus = new BehaviorSubject('disconnected');\n      this.connectionStatus$ = this.connectionStatus.asObservable();\n      this.ws = null;\n      this.simulationMode = false;\n      this.simulationInterval = null;\n      console.log('ðŸš€ WebSocket Service - KUBERNETES FIXED V2');\n      console.log('   - Using Kubernetes service URL');\n      this.connectToBackend();\n    }\n    connectToBackend() {\n      try {\n        // âœ… URL ABSOLUTAMENTE CORRECTA para Kubernetes\n        const wsUrl = 'ws://backend-service.skysense.svc.cluster.local:8000/ws/sensors';\n        console.log('ðŸ”„ CONNECTING to Kubernetes WebSocket...');\n        console.log('   - Target URL:', wsUrl);\n        console.log('   - Browser location:', window.location.href);\n        this.connectionStatus.next('connecting');\n        this.ws = new WebSocket(wsUrl);\n        this.ws.onopen = () => {\n          console.log('âœ… âœ… âœ… SUCCESS! Connected to Kubernetes WebSocket');\n          console.log('   - Backend service is reachable');\n          this.connectionStatus.next('connected');\n          this.simulationMode = false;\n          if (this.simulationInterval) {\n            clearInterval(this.simulationInterval);\n            this.simulationInterval = null;\n          }\n        };\n        this.ws.onmessage = event => {\n          try {\n            const data = JSON.parse(event.data);\n            console.log('ðŸ“Š REAL DATA from backend:', {\n              sensor: data.sensor_id,\n              temperature: data.temperature + 'Â°C',\n              humidity: data.humidity + '%',\n              pressure: data.pressure + ' hPa'\n            });\n            this.sensorsSubject.next(data);\n          } catch (error) {\n            console.error('âŒ Error parsing message:', error);\n          }\n        };\n        this.ws.onerror = error => {\n          console.error('âŒ WebSocket ERROR - Cannot reach backend in Kubernetes');\n          console.error('   - URL attempted:', wsUrl);\n          console.error('   - This means:');\n          console.error('     1. Backend service is not running');\n          console.error('     2. Network connectivity issue');\n          console.error('     3. Backend not exposing WebSocket port');\n          this.connectionStatus.next('error');\n          this.startSimulation();\n        };\n        this.ws.onclose = event => {\n          console.log('ðŸ”Œ WebSocket connection closed');\n          console.log('   - Code:', event.code, 'Reason:', event.reason);\n          this.connectionStatus.next('disconnected');\n          if (!this.simulationMode) {\n            console.log('ðŸ”„ Will retry in 5 seconds...');\n            setTimeout(() => this.connectToBackend(), 5000);\n          }\n        };\n      } catch (error) {\n        console.error('âŒ CRITICAL: Failed to create WebSocket:', error);\n        this.connectionStatus.next('error');\n        this.startSimulation();\n      }\n    }\n    startSimulation() {\n      if (!this.simulationMode) {\n        console.log('ðŸŽ­ STARTING SIMULATION MODE');\n        console.log('   - Backend WebSocket is not available');\n        this.simulationMode = true;\n        this.connectionStatus.next('simulation');\n        this.simulationInterval = setInterval(() => {\n          const simulatedData = {\n            sensor_id: 'simulated_' + Math.floor(5 * Math.random()),\n            temperature: parseFloat((20 + 15 * Math.random()).toFixed(1)),\n            humidity: parseFloat((40 + 40 * Math.random()).toFixed(1)),\n            pressure: parseFloat((990 + 40 * Math.random()).toFixed(1)),\n            timestamp: new Date().toISOString()\n          };\n          console.log('ðŸŽ­ SIMULATED data (fallback):', {\n            sensor: simulatedData.sensor_id,\n            temp: simulatedData.temperature + 'Â°C'\n          });\n          this.sensorsSubject.next(simulatedData);\n        }, 2000);\n      }\n    }\n    isSimulationMode() {\n      return this.simulationMode;\n    }\n    disconnect() {\n      if (this.simulationInterval) {\n        clearInterval(this.simulationInterval);\n        this.simulationMode = false;\n        this.simulationInterval = null;\n      }\n      if (this.ws) {\n        this.ws.close();\n        this.ws = null;\n      }\n    }\n    reconnect() {\n      console.log('ðŸ”„ Manual reconnect requested');\n      this.disconnect();\n      this.connectToBackend();\n    }\n    static {\n      this.Éµfac = function WebsocketService_Factory(t) {\n        return new (t || WebsocketService)();\n      };\n    }\n    static {\n      this.Éµprov = /*@__PURE__*/i0.ÉµÉµdefineInjectable({\n        token: WebsocketService,\n        factory: WebsocketService.Éµfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return WebsocketService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}