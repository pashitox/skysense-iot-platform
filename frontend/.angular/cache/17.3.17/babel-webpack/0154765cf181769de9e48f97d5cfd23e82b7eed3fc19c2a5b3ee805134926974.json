{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nexport let WebsocketService = /*#__PURE__*/(() => {\n  class WebsocketService {\n    constructor() {\n      this.sensorsSubject = new BehaviorSubject(null);\n      this.sensors$ = this.sensorsSubject.asObservable();\n      this.connectionStatus = new BehaviorSubject('disconnected');\n      this.connectionStatus$ = this.connectionStatus.asObservable();\n      this.ws = null;\n      this.simulationMode = false;\n      this.simulationInterval = null;\n      console.log('ðŸ”§ WebSocket Service - KUBERNETES FIXED');\n      this.connectToBackend();\n    }\n    connectToBackend() {\n      try {\n        // âœ… URL FIJA Y CORRECTA para Kubernetes\n        const wsUrl = 'ws://backend-service.skysense.svc.cluster.local:8000/ws/sensors';\n        console.log('ðŸ”„ CONNECTING to WebSocket...');\n        console.log('   - URL:', wsUrl);\n        console.log('   - Browser URL:', window.location.href);\n        this.connectionStatus.next('connecting');\n        this.ws = new WebSocket(wsUrl);\n        this.ws.onopen = () => {\n          console.log('âœ… âœ… âœ… SUCCESS: Connected to WebSocket!');\n          this.connectionStatus.next('connected');\n          this.simulationMode = false;\n          if (this.simulationInterval) {\n            clearInterval(this.simulationInterval);\n            this.simulationInterval = null;\n          }\n        };\n        this.ws.onmessage = event => {\n          try {\n            const data = JSON.parse(event.data);\n            console.log('ðŸ“Š REAL DATA:', data.sensor_id, data.temperature + 'Â°C');\n            this.sensorsSubject.next(data);\n          } catch (error) {\n            console.error('âŒ Error parsing message:', error);\n          }\n        };\n        this.ws.onerror = error => {\n          console.error('âŒ WebSocket ERROR - Using simulation');\n          console.error('   - This is normal during development');\n          this.connectionStatus.next('error');\n          this.startSimulation();\n        };\n        this.ws.onclose = event => {\n          console.log('ðŸ”Œ WebSocket closed');\n          this.connectionStatus.next('disconnected');\n          if (!this.simulationMode) {\n            setTimeout(() => this.connectToBackend(), 5000);\n          }\n        };\n      } catch (error) {\n        console.error('âŒ Failed to create WebSocket:', error);\n        this.connectionStatus.next('error');\n        this.startSimulation();\n      }\n    }\n    startSimulation() {\n      if (!this.simulationMode) {\n        console.log('ðŸŽ­ Starting SIMULATION mode');\n        this.simulationMode = true;\n        this.connectionStatus.next('simulation');\n        this.simulationInterval = setInterval(() => {\n          const simulatedData = {\n            sensor_id: 'simulated_' + Math.floor(5 * Math.random()),\n            temperature: parseFloat((20 + 15 * Math.random()).toFixed(1)),\n            humidity: parseFloat((40 + 40 * Math.random()).toFixed(1)),\n            pressure: parseFloat((990 + 40 * Math.random()).toFixed(1)),\n            timestamp: new Date().toISOString()\n          };\n          console.log('ðŸŽ­ SIMULATION:', simulatedData.sensor_id, simulatedData.temperature + 'Â°C');\n          this.sensorsSubject.next(simulatedData);\n        }, 2000);\n      }\n    }\n    isSimulationMode() {\n      return this.simulationMode;\n    }\n    disconnect() {\n      if (this.simulationInterval) {\n        clearInterval(this.simulationInterval);\n        this.simulationMode = false;\n      }\n      if (this.ws) {\n        this.ws.close();\n        this.ws = null;\n      }\n    }\n    reconnect() {\n      this.disconnect();\n      this.connectToBackend();\n    }\n    static {\n      this.Éµfac = function WebsocketService_Factory(t) {\n        return new (t || WebsocketService)();\n      };\n    }\n    static {\n      this.Éµprov = /*@__PURE__*/i0.ÉµÉµdefineInjectable({\n        token: WebsocketService,\n        factory: WebsocketService.Éµfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return WebsocketService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}